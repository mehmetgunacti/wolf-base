<div buttons cdkMenuBar class="d-flex ai-c padding-xxs wrap">

	<!-- SAVE BUTTON -->
	<button
		cdkMenuItem
		class="link"
		(click)="onSave()"
		title="Save Changes"
		[disabled]="!control.dirty"
		[cdkMenuItemDisabled]="!control.dirty">
		<span class="material-symbols-outlined">save</span>
	</button>

	<!-- CANCEL BUTTON -->
	<button
		cdkMenuItem
		class="link"
		title="Close Editor"
		(click)="onCancel(control.dirty)">
		<span class="material-symbols-outlined">cancel</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- PREVIEW BUTTON -->
	<button
		cdkMenuItem
		class="link"
		title="Open Preview"
		(click)="onPreviewOpen()">
		<span class="material-symbols-outlined">live_tv</span>
	</button>

	<!-- RECOVER BUTTON -->
	<button
		cdkMenuItem
		class="link"
		title="Recover"
		[class.shake]="btnOpenRecovery()"
		(click)="onRecoverOpen()">
		<span class="material-symbols-outlined">device_reset</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- UNDO BUTTON -->
	<button
		cdkMenuItem
		class="link"
		(click)="onUndo()"
		title="Undo"
		[disabled]="!undoCache.canUndo()"
		[cdkMenuItemDisabled]="!undoCache.canUndo()">
		<span class="material-symbols-outlined">undo</span>
	</button>

	<!-- REDO BUTTON -->
	<button
		cdkMenuItem
		class="link"
		(click)="onRedo()"
		title="Redo"
		[disabled]="!undoCache.canRedo()"
		[cdkMenuItemDisabled]="!undoCache.canRedo()">
		<span class="material-symbols-outlined">redo</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- HEADING BUTTON -->
	<button
		class="link"
		[cdkMenuTriggerFor]="format_heading"
		title="Heading"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_h1</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- BOLD BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addBold(editor))"
		title="Bold"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_bold</span>
	</button>

	<!-- ITALIC BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addItalic(editor))"
		title="Italic"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_italic</span>
	</button>

	<!-- STRIKETHROUGH BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addStrikethrough(editor))"
		title="Strikethrough"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_strikethrough</span>
	</button>

	<!-- HIGHLIGHT BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addHighlight(editor))"
		title="Highlight"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_ink_highlighter</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- ALIGN CENTER BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addAlignCenter(editor))"
		title="Align Center"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_center</span>
	</button>

	<!-- ALIGN RIGHT BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addAlignRight(editor))"
		title="Align Right"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_right</span>
	</button>

	<!-- ALIGN JUSTIFY BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addAlignJustify(editor))"
		title="Align Justify"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_justify</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- SUB BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addSub(editor))"
		title="Subscript (H2O)"
		cdkMenuItem>
		<span class="material-symbols-outlined">subscript</span>
	</button>

	<!-- SUP BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addSup(editor))"
		title="Superscript (E=mc2)"
		cdkMenuItem>
		<span class="material-symbols-outlined">superscript</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- BULLETED LIST BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addListBulleted(editor))"
		title="Bulleted List"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_list_bulleted</span>
	</button>

	<!-- LIST NUMBERED BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addListNumbered(editor))"
		title="Numbered List"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_list_numbered</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- DECREASE INDENT BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.decreaseIndent(editor))"
		title="Decrease Indent"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_indent_decrease</span>
	</button>

	<!-- INCREASE INDENT BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.increaseIndent(editor))"
		title="Increase Indent"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_indent_increase</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- ADD CHECKBOX (TASK) BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addEmptyTask(editor))"
		title="Task"
		cdkMenuItem>
		<span class="material-symbols-outlined">check_box</span>
	</button>

	<!-- ADD TABLE BUTTON -->
	<button
		class="link"
		[cdkMenuTriggerFor]="table_menu"
		title="Table"
		cdkMenuItem>
		<span class="material-symbols-outlined">table</span>
	</button>

	<!-- CODE BUTTON -->
	<button
		class="link"
		[cdkMenuTriggerFor]="code_menu"
		title="Code"
		cdkMenuItem>
		<span class="material-symbols-outlined">code_blocks</span>
	</button>

	<!-- ADD BLOCKQUOTE BUTTON -->
	<button
		class="link"
		[cdkMenuTriggerFor]="blockquote_menu"
		title="Blockquote"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_quote</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- IMAGE FROM CLIPBOARD BUTTON -->
	<button
		#btnImage
		class="link"
		(click)="addImage(btnImage)"
		title="Image from Clipboard"
		[class.shake]="btnImageShake()"
		cdkMenuItem>
		<span class="material-symbols-outlined">image</span>
	</button>

	<!-- TOC BUTTON -->
	<button
		class="link"
		(click)="updateEditor(actions.addToc(editor))"
		title="Table of Contents"
		cdkMenuItem>
		<span class="material-symbols-outlined">toc</span>
	</button>

</div>

<div area class="flex-1 d-flex-column pos-relative">

	<textarea
		#editor
		class="flex-1 pt cur-auto"
		[ngClass]="{ 'ng-invalid ng-dirty': control.invalid && control.dirty }"
		placeholder=""
		[formControl]="control"
		[readonly]="readonly"
		(focus)="hasFocus.set(true)"
		(blur)="hasFocus.set(false)"
		required></textarea>
	<label>{{name}}</label>
	<label class="up right">
		<span class="icon-container">
			<span class="material-symbols-outlined">description</span>
			<span>{{ undoCache.discSize() }}</span>
		</span>
		<span class="icon-container">
			<span class="material-symbols-outlined">memory</span>
			<span>{{ undoCache.memSize() }}</span>
		</span>
	</label>

</div>

<ng-template #previewTemplate>

	<w-overlay-container>

		<ng-container card_title>Preview</ng-container>
		<ng-container card_buttons>

			<button
				class="link rounded"
				(click)="onPreviewClose()">
				<span class="material-symbols-outlined">close</span>
			</button>

		</ng-container>

		<w-markdown-viewer [markdown]="undoCache.props().content"/>

	</w-overlay-container>

</ng-template>

<ng-template #recoverTemplate>

	<w-overlay-container cdkMenu>

		<ng-container card_title>Recover</ng-container>
		<ng-container card_buttons>

			<button
				cdkMenuItem
				class="link rounded"
				[disabled]="!recoveryManager.hasPrev()"
				[cdkMenuItemDisabled]="!recoveryManager.hasPrev()"
				(click)="recoveryManager.previous()">
				<span class="material-symbols-outlined">navigate_before</span>
			</button>
			<button
				cdkMenuItem
				class="link rounded"
				[disabled]="!recoveryManager.hasNext()"
				[cdkMenuItemDisabled]="!recoveryManager.hasNext()"
				(click)="recoveryManager.next()">
				<span class="material-symbols-outlined">navigate_next</span>
			</button>
			<button
				cdkMenuItem
				class="link rounded"
				(click)="onRecoverReplace()">
				<span class="material-symbols-outlined">published_with_changes</span>
				<span>Replace</span>
			</button>
			<button
				cdkMenuItem
				class="link rounded"
				(click)="onRecoverClose()">
				<span class="material-symbols-outlined">close</span>
			</button>

		</ng-container>

		@if(recoveryManager.recoverableContent(); as lsEntry) {

			<h6>{{ lsEntry.time.toUTCString() | timePast:true:'precise' }}</h6>
			<pre>{{lsEntry.content}}</pre>
			<!-- <w-markdown-viewer [markdown]="lsEntry.content"/> -->

		}

	</w-overlay-container>

</ng-template>

<ng-template #table_menu>

	<div class="menu" cdkMenu>

		<w-selector-table
			[rows]="6"
			[cols]="7"
			(result)="updateEditor(actions.addTable(editor, $event))"/>

	</div>

</ng-template>

<ng-template #format_heading>

	<div>

		<div class="menu scrollable" cdkMenu>

			<!-- H1 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '#'))"
				title="Align Center"
				cdkMenuItem>
				<h1>Heading 1</h1>
			</button>

			<!-- H2 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '##'))"
				title="Heading 2"
				cdkMenuItem>
				<h2>Heading 2</h2>
			</button>

			<!-- H3 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '###'))"
				title="Heading 3"
				cdkMenuItem>
				<h3>Heading 3</h3>
			</button>

			<!-- H4 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '####'))"
				title="Heading 4"
				cdkMenuItem>
				<h4>Heading 4</h4>
			</button>

			<!-- H5 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '#####'))"
				title="Heading 5"
				cdkMenuItem>
				<h5>Heading 5</h5>
			</button>

			<!-- H6 BUTTON -->
			<button
				class="link"
				(click)="updateEditor(actions.addHeading(editor, '######'))"
				title="Heading 6"
				cdkMenuItem>
				<h6>Heading 6</h6>
			</button>

		</div>

	</div>

</ng-template>

<ng-template #blockquote_menu>

	<div class="menu quote-menu gap-sm" cdkMenu>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor))" cdkMenuItem>
			<span class="default"></span>
			<span>Blockquote</span>
		</button>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor, 'note'))" cdkMenuItem>
			<span class="primary"></span>
			<span>&quot;Note&quot;</span>
		</button>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor, 'tip'))" cdkMenuItem>
			<span class="success"></span>
			<span>&quot;Tip&quot;</span>
		</button>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor, 'important'))" cdkMenuItem>
			<span class="info"></span>
			<span>&quot;Important&quot;</span>
		</button>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor, 'warning'))" cdkMenuItem>
			<span class="warn"></span>
			<span>&quot;Warning&quot;</span>
		</button>

		<button class="medium icon-only align-left" (click)="updateEditor(actions.addBlockquote(editor, 'caution'))" cdkMenuItem>
			<span class="error"></span>
			<span>&quot;Caution&quot;</span>
		</button>

	</div>

</ng-template>

<ng-template #code_menu>

	<div>

		<div class="menu scrollable code-menu" cdkMenu>

			<fieldset>
				<!-- INLINE CODE BUTTON -->
				<button class="link small" (click)="updateEditor(actions.addInlineCode(editor))" cdkMenuItem>
					<span class="material-symbols-outlined small">code</span>
					<span>Inline Code</span>
				</button>
			</fieldset>

			<!-- todo: convert to for loop(?) -->
			<fieldset>
				<legend>Frequent</legend>

				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>Empty Block</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'java'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>java</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'typescript'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>typescript</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'javascript'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>javascript</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'scss'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>scss</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'bash'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>bash</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'sql'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>sql</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'xml'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>xml</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'yaml'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>yaml</span>
				</button>

			</fieldset>

			<fieldset>
				<legend>Other</legend>

				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'asciidoc'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>asciidoc</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'autohotkey'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>autohotkey</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'c'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>c</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'cpp'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>cpp</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'css'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>css</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'dockerfile'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>dockerfile</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'gradle'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>gradle</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'http'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>http</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'ini'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>ini</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'json'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>json</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'kotlin'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>kotlin</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'markdown'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>markdown</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'powershell'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>powershell</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'properties'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>properties</span>
				</button>
				<button class="link small" (click)="updateEditor(actions.addCodeBlock(editor, 'python'))" cdkMenuItem>
					<span class="material-symbols-outlined small">chevron_right</span>
					<span>python</span>
				</button>

			</fieldset>

		</div>

	</div>

</ng-template>
