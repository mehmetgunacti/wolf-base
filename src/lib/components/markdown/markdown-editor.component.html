<div buttons cdkMenuBar>

	<!-- SAVE BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		(click)="onSave()"
		title="Save Changes"
		[disabled]="!control.dirty"
		[cdkMenuItemDisabled]="!control.dirty">
		<span class="material-symbols-outlined">save</span>
	</button>

	<!-- CANCEL BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		title="Close Editor"
		(click)="onCancel(control.dirty)">
		<span class="material-symbols-outlined">cancel</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- PREVIEW BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		title="Open Preview"
		(click)="onPreviewOpen()">
		<span class="material-symbols-outlined">live_tv</span>
	</button>

	<!-- RECOVER BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		title="Recover"
		[class.shake]="btnOpenRecovery()"
		(click)="onRecoverOpen()">
		<span class="material-symbols-outlined">device_reset</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- UNDO BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		(click)="onUndo()"
		title="Undo"
		[disabled]="!undoCache.canUndo()"
		[cdkMenuItemDisabled]="!undoCache.canUndo()">
		<span class="material-symbols-outlined">undo</span>
	</button>

	<!-- REDO BUTTON -->
	<button
		cdkMenuItem
		class="glyph squared"
		(click)="onRedo()"
		title="Redo"
		[disabled]="!undoCache.canRedo()"
		[cdkMenuItemDisabled]="!undoCache.canRedo()">
		<span class="material-symbols-outlined">redo</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- HEADING BUTTON -->
	<button
		class="glyph squared"
		[cdkMenuTriggerFor]="format_heading"
		title="Heading"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_h1</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- BOLD BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addBold(editor))"
		title="Bold"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_bold</span>
	</button>

	<!-- ITALIC BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addItalic(editor))"
		title="Italic"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_italic</span>
	</button>

	<!-- STRIKETHROUGH BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addStrikethrough(editor))"
		title="Strikethrough"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_strikethrough</span>
	</button>

	<!-- HIGHLIGHT BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addHighlight(editor))"
		title="Highlight"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_ink_highlighter</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- ALIGN CENTER BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addAlignCenter(editor))"
		title="Align Center"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_center</span>
	</button>

	<!-- ALIGN RIGHT BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addAlignRight(editor))"
		title="Align Right"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_right</span>
	</button>

	<!-- ALIGN JUSTIFY BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addAlignJustify(editor))"
		title="Align Justify"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_align_justify</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- SUB BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addSub(editor))"
		title="Subscript (H2O)"
		cdkMenuItem>
		<span class="material-symbols-outlined">subscript</span>
	</button>

	<!-- SUP BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addSup(editor))"
		title="Superscript (E=mc2)"
		cdkMenuItem>
		<span class="material-symbols-outlined">superscript</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- BULLETED LIST BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addListBulleted(editor))"
		title="Bulleted List"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_list_bulleted</span>
	</button>

	<!-- LIST NUMBERED BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addListNumbered(editor))"
		title="Numbered List"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_list_numbered</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- DECREASE INDENT BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.decreaseIndent(editor))"
		title="Decrease Indent"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_indent_decrease</span>
	</button>

	<!-- INCREASE INDENT BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.increaseIndent(editor))"
		title="Increase Indent"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_indent_increase</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- ADD CHECKBOX (TASK) BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addEmptyTask(editor))"
		title="Task"
		cdkMenuItem>
		<span class="material-symbols-outlined">check_box</span>
	</button>

	<!-- ADD TABLE BUTTON -->
	<button
		class="glyph squared"
		[cdkMenuTriggerFor]="table_menu"
		title="Table"
		cdkMenuItem>
		<span class="material-symbols-outlined">table</span>
	</button>

	<!-- CODE BUTTON -->
	<button
		class="glyph squared"
		[cdkMenuTriggerFor]="code_menu"
		title="Code"
		cdkMenuItem>
		<span class="material-symbols-outlined">code_blocks</span>
	</button>

	<!-- ADD BLOCKQUOTE BUTTON -->
	<button
		class="glyph squared"
		[cdkMenuTriggerFor]="blockquote_menu"
		title="Blockquote"
		cdkMenuItem>
		<span class="material-symbols-outlined">format_quote</span>
	</button>

	<!-- DIVIDER -->
	<div class="v-divider"></div>

	<!-- IMAGE FROM CLIPBOARD BUTTON -->
	<button
		#btnImage
		class="glyph squared"
		(click)="addImage(btnImage)"
		title="Image from Clipboard"
		[class.shake]="btnImageShake()"
		cdkMenuItem>
		<span class="material-symbols-outlined">image</span>
	</button>

	<!-- TOC BUTTON -->
	<button
		class="glyph squared"
		(click)="updateEditor(actions.addToc(editor))"
		title="Table of Contents"
		cdkMenuItem>
		<span class="material-symbols-outlined">toc</span>
	</button>

</div>

<div area>

	<textarea
		#editor
		[ngClass]="{ 'ng-invalid ng-dirty': control.invalid && control.dirty }"
		placeholder=""
		[formControl]="control"
		[readonly]="readonly"
		(focus)="hasFocus.set(true)"
		(blur)="hasFocus.set(false)"
		[rows]="rows()"
		required></textarea>
	<label>{{name}}</label>
	<label class="up right">
		<span class="icon-container">
			<span class="material-symbols-outlined">description</span>
			<span>{{ undoCache.discSize() }}</span>
		</span>
		<span class="icon-container">
			<span class="material-symbols-outlined">memory</span>
			<span>{{ undoCache.memSize() }}</span>
		</span>
	</label>

</div>

@if (showPreview()) {

	<w-modal (close)="onPreviewClose()">
		<div class="overlay-content">

			<header>
				<div title>Preview</div>
				<div title_buttons>

					<button
						class="glyph"
						(click)="onPreviewClose()">
						<span class="material-symbols-outlined">close</span>
					</button>

				</div>
			</header>
			<div content_wrapper>
				<div content>
					<w-markdown-viewer [markdown]="undoCache.props().content"/>
				</div>
			</div>

		</div>
	</w-modal>

}

@if (showRecover()) {

	<w-modal (close)="onRecoverClose()">
		<div class="overlay-content" cdkMenu>

			<header>
				<div title>Recover</div>
				<div title_buttons>

					<button
						cdkMenuItem
						class="glyph"
						[disabled]="!recoveryManager.hasPrev()"
						[cdkMenuItemDisabled]="!recoveryManager.hasPrev()"
						(click)="recoveryManager.previous()">
						<span class="material-symbols-outlined">navigate_before</span>
					</button>
					<button
						cdkMenuItem
						class="glyph"
						[disabled]="!recoveryManager.hasNext()"
						[cdkMenuItemDisabled]="!recoveryManager.hasNext()"
						(click)="recoveryManager.next()">
						<span class="material-symbols-outlined">navigate_next</span>
					</button>
					<button
						cdkMenuItem
						class="ghost"
						(click)="onRecoverReplace()">
						<span class="material-symbols-outlined">published_with_changes</span>
						<span>Replace</span>
					</button>
					<button
						cdkMenuItem
						class="glyph"
						(click)="onRecoverClose()">
						<span class="material-symbols-outlined">close</span>
					</button>

				</div>
			</header>
			<div content>

				@if(recoveryManager.recoverableContent(); as lsEntry) {

					<h6>{{ lsEntry.time.toUTCString() | timePast:true:'precise' }}</h6>
					<pre>{{lsEntry.content}}</pre>
					<w-markdown-viewer [markdown]="lsEntry.content"/>

				}

			</div>

		</div>
	</w-modal>

}

<ng-template #table_menu>

	<div class="table-menu" cdkMenu>

		<w-selector-table
			[rows]="6"
			[cols]="7"
			(result)="updateEditor(actions.addTable(editor, $event))"/>

	</div>

</ng-template>

<ng-template #format_heading>

	<div class="format-menu" cdkMenu>

		<div>

			<!-- H1 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '#'))"
				title="Align Center"
				cdkMenuItem>
				<h1>Heading 1</h1>
			</button>

			<!-- H2 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '##'))"
				title="Heading 2"
				cdkMenuItem>
				<h2>Heading 2</h2>
			</button>

			<!-- H3 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '###'))"
				title="Heading 3"
				cdkMenuItem>
				<h3>Heading 3</h3>
			</button>

			<!-- H4 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '####'))"
				title="Heading 4"
				cdkMenuItem>
				<h4>Heading 4</h4>
			</button>

			<!-- H5 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '#####'))"
				title="Heading 5"
				cdkMenuItem>
				<h5>Heading 5</h5>
			</button>

			<!-- H6 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '######'))"
				title="Heading 6"
				cdkMenuItem>
				<h6>Heading 6</h6>
			</button>

		</div>

	</div>

</ng-template>

<ng-template #blockquote_menu>

	<div class="quote-menu" cdkMenu>

		<div>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor))" cdkMenuItem data-after="Blockquote">
				<span class="default"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'note'))" cdkMenuItem data-after="Note">
				<span class="primary"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'tip'))" cdkMenuItem data-after="Tip">
				<span class="success"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'important'))" cdkMenuItem data-after="Important">
				<span class="info"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'warning'))" cdkMenuItem data-after="Warning">
				<span class="warn"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'caution'))" cdkMenuItem data-after="Caution">
				<span class="error"></span>
			</button>

		</div>

	</div>

</ng-template>

<ng-template #code_menu>

	<div class="code-menu" cdkMenu>

		<div>

			<fieldset>
				<!-- INLINE CODE BUTTON -->
				<button class="ghost sm left w100" (click)="updateEditor(actions.addInlineCode(editor))" cdkMenuItem data-after="Inline Code">
					<span class="material-symbols-outlined small">code</span>
				</button>
			</fieldset>

			<!-- todo: convert to for loop(?) -->
			<fieldset>
				<legend>Frequent</legend>

				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor))" cdkMenuItem data-after="Empty Block">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'java'))" cdkMenuItem data-after="java">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'typescript'))" cdkMenuItem data-after="typescript">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'javascript'))" cdkMenuItem data-after="javascript">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'scss'))" cdkMenuItem data-after="scss">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'bash'))" cdkMenuItem data-after="bash">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'sql'))" cdkMenuItem data-after="sql">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'xml'))" cdkMenuItem data-after="xml">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'yaml'))" cdkMenuItem data-after="yaml">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>

			</fieldset>

			<fieldset>
				<legend>Other</legend>

				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'asciidoc'))" cdkMenuItem data-after="asciidoc">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'autohotkey'))" cdkMenuItem data-after="autohotkey">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'c'))" cdkMenuItem data-after="c">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'cpp'))" cdkMenuItem data-after="cpp">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'css'))" cdkMenuItem data-after="css">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'dockerfile'))" cdkMenuItem data-after="dockerfile">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'gradle'))" cdkMenuItem data-after="gradle">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'http'))" cdkMenuItem data-after="http">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'ini'))" cdkMenuItem data-after="ini">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'json'))" cdkMenuItem data-after="json">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'kotlin'))" cdkMenuItem data-after="kotlin">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'markdown'))" cdkMenuItem data-after="markdown">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'powershell'))" cdkMenuItem data-after="powershell">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'properties'))" cdkMenuItem data-after="properties">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>
				<button class="ghost sm left w100" (click)="updateEditor(actions.addCodeBlock(editor, 'python'))" cdkMenuItem data-after="python">
					<span class="material-symbols-outlined small">chevron_right</span>
				</button>

			</fieldset>

		</div>

	</div>

</ng-template>
