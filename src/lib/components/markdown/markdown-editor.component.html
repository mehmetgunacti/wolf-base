@let btnClass = 'btn btn-ghost px-1 rounded h-button-height-2xs text-base md:h-button-height-sm md:px-2 md:text-lg lg:text-xl';

<div cdkMenuBar class="flex flex-wrap items-center gap-[2px] p-2 bg-form-element-border rounded-t-lg">

	<!-- SAVE BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		(click)="onSave()"
		title="Save Changes"
		[disabled]="!dirty()"
		[cdkMenuItemDisabled]="!dirty()">
		<svg wGlyph="save"></svg>
	</button>

	<!-- CANCEL BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		title="Close Editor"
		(click)="onCancel(dirty())">
		<svg wGlyph="cancel"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- PREVIEW BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		title="Open Preview"
		(click)="onPreviewOpen()">
		<svg wGlyph="live_tv"></svg>
	</button>

	<!-- RECOVER BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		title="Recover"
		[class.shake]="btnOpenRecovery()"
		(click)="onRecoverOpen()">
		<svg wGlyph="recover"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- UNDO BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		(click)="onUndo()"
		title="Undo"
		[disabled]="!undoCache.canUndo()"
		[cdkMenuItemDisabled]="!undoCache.canUndo()">
		<svg wGlyph="undo"></svg>
	</button>

	<!-- REDO BUTTON -->
	<button
		cdkMenuItem
		[class]="btnClass"
		(click)="onRedo()"
		title="Redo"
		[disabled]="!undoCache.canRedo()"
		[cdkMenuItemDisabled]="!undoCache.canRedo()">
		<svg wGlyph="redo"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- HEADING BUTTON -->
	<button
		[class]="btnClass"
		[cdkMenuTriggerFor]="format_heading"
		title="Heading"
		cdkMenuItem>
		<svg wGlyph="format_h1"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- BOLD BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addBold(editor))"
		title="Bold"
		cdkMenuItem>
		<svg wGlyph="format_bold"></svg>
	</button>

	<!-- ITALIC BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addItalic(editor))"
		title="Italic"
		cdkMenuItem>
		<svg wGlyph="format_italic"></svg>
	</button>

	<!-- STRIKETHROUGH BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addStrikethrough(editor))"
		title="Strikethrough"
		cdkMenuItem>
		<svg wGlyph="format_strikethrough"></svg>
	</button>

	<!-- HIGHLIGHT BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addHighlight(editor))"
		title="Highlight"
		cdkMenuItem>
		<svg wGlyph="format_ink_highlighter"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- ALIGN CENTER BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addAlignCenter(editor))"
		title="Align Center"
		cdkMenuItem>
		<svg wGlyph="format_align_center"></svg>
	</button>

	<!-- ALIGN RIGHT BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addAlignRight(editor))"
		title="Align Right"
		cdkMenuItem>
		<svg wGlyph="format_align_right"></svg>
	</button>

	<!-- ALIGN JUSTIFY BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addAlignJustify(editor))"
		title="Align Justify"
		cdkMenuItem>
		<svg wGlyph="format_align_justify"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- SUB BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addSub(editor))"
		title="Subscript (H2O)"
		cdkMenuItem>
		<svg wGlyph="subscript"></svg>
	</button>

	<!-- SUP BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addSup(editor))"
		title="Superscript (E=mc2)"
		cdkMenuItem>
		<svg wGlyph="superscript"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- BULLETED LIST BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addListBulleted(editor))"
		title="Bulleted List"
		cdkMenuItem>
		<svg wGlyph="format_list_bulleted"></svg>
	</button>

	<!-- LIST NUMBERED BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addListNumbered(editor))"
		title="Numbered List"
		cdkMenuItem>
		<svg wGlyph="format_list_numbered"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- DECREASE INDENT BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.decreaseIndent(editor))"
		title="Decrease Indent"
		cdkMenuItem>
		<svg wGlyph="format_indent_decrease"></svg>
	</button>

	<!-- INCREASE INDENT BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.increaseIndent(editor))"
		title="Increase Indent"
		cdkMenuItem>
		<svg wGlyph="format_indent_increase"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- ADD CHECKBOX (TASK) BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addEmptyTask(editor))"
		title="Task"
		cdkMenuItem>
		<svg wGlyph="check_box"></svg>
	</button>

	<!-- ADD TABLE BUTTON -->
	<button
		[class]="btnClass"
		[cdkMenuTriggerFor]="table_menu"
		title="Table"
		cdkMenuItem>
		<svg wGlyph="table"></svg>
	</button>

	<!-- CODE BUTTON -->
	<button
		[class]="btnClass"
		[cdkMenuTriggerFor]="code_menu"
		title="Code"
		cdkMenuItem>
		<svg wGlyph="code_blocks"></svg>
	</button>

	<!-- ADD BLOCKQUOTE BUTTON -->
	<button
		[class]="btnClass"
		[cdkMenuTriggerFor]="blockquote_menu"
		title="Blockquote"
		cdkMenuItem>
		<svg wGlyph="format_quote"></svg>
	</button>

	<!-- DIVIDER -->
	<div class="border-r border-r-ghost-hover h-button-height-2xs md:h-button-height-xs"></div>

	<!-- IMAGE FROM CLIPBOARD BUTTON -->
	<button
		#btnImage
		[class]="btnClass"
		(click)="addImage(btnImage)"
		title="Image from Clipboard"
		[class.shake]="btnImageShake()"
		cdkMenuItem>
		<svg wGlyph="image"></svg>
	</button>

	<!-- TOC BUTTON -->
	<button
		[class]="btnClass"
		(click)="updateEditor(actions.addToc(editor))"
		title="Table of Contents"
		cdkMenuItem>
		<svg wGlyph="toc"></svg>
	</button>

</div>

@if (showPreview()) {

	<w-modal (close)="onPreviewClose()">
		<div class="h-full">

			<header class="flex items-center p-2">
				<div class="ml-2 font-bold text-2xl text-content">Preview</div>
				<div class="ml-auto">

					<button
						class="btn btn-glyph"
						(click)="onPreviewClose()">
						<svg wGlyph="close"></svg>
					</button>

				</div>
			</header>
			<!-- CONTENT WRAPPER -->
			<section class="h-full overflow-y-auto scrollbar scrollbar-gutter-stable">
				<!-- CONTENT -->
				<div class="p-3 text-content">
					<!-- <w-markdown-viewer [markdown]="undoCache.props().content"/> -->
					Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nobis blanditiis aspernatur autem sequi nesciunt! Minus nobis, illum quae iusto libero explicabo obcaecati neque cupiditate aspernatur magni iure expedita sint nesciunt.
					Nemo, expedita doloribus temporibus deserunt optio corrupti aliquid id? Voluptatem vitae dolorem iure, nobis maiores, magnam perferendis quisquam incidunt quia quas a, facere officia voluptates animi quae voluptatum quis ex!
					Perferendis maiores eos veritatis ipsam dolorum molestias? Aut, totam veniam expedita quae recusandae maxime aspernatur nobis vero distinctio ex consectetur praesentium dolorem dignissimos aliquid unde exercitationem commodi nam optio cumque!
					Debitis nobis id aliquid itaque quae minima quo cum ducimus nam, mollitia inventore distinctio explicabo voluptatum, alias aspernatur atque cupiditate dicta quisquam necessitatibus deserunt ipsa? Facilis reiciendis animi ipsa sapiente!
					Necessitatibus quaerat deleniti doloremque ut impedit labore aspernatur corrupti eveniet qui? Laudantium perspiciatis incidunt dignissimos recusandae, quo officiis odit quae voluptates cum officia doloribus nemo, amet eum, ratione accusamus possimus!
					Accusantium architecto laborum illo voluptatibus ratione, explicabo, officiis ab pariatur quasi ex dolor laudantium blanditiis aperiam molestiae eum tempore aspernatur praesentium? Asperiores expedita quos rerum recusandae eligendi? Ab, magni. Harum.
					Excepturi, quod neque dolorem pariatur quo aspernatur officiis qui iste ratione accusamus eveniet. Est, culpa amet. Aspernatur molestias debitis omnis nisi doloribus iure beatae repudiandae quaerat placeat, dolorum explicabo! Asperiores?
					Facere odit atque itaque sequi, numquam dignissimos fuga voluptatem ipsa eos est deserunt suscipit ipsum blanditiis veniam nostrum aperiam hic modi ipsam distinctio repellendus quo totam in, quis officia. Culpa!
					Alias laudantium quibusdam vel eos voluptas in quaerat quisquam nemo natus inventore, veritatis quis ratione velit ipsam explicabo soluta nisi corporis facilis sit iusto cum, cumque debitis. Quibusdam, commodi natus!
					Amet dolore quo quibusdam dolorem, iusto dicta cum quia reiciendis minima hic ullam, consequatur inventore commodi pariatur ad eligendi nam? Fugiat aspernatur deserunt reiciendis nemo, quidem dolorum quae nam aperiam!
				</div>
			</section>

		</div>
	</w-modal>

}

@if (showRecover()) {

	<w-modal (close)="onRecoverClose()">
		<div class="overlay-content" cdkMenu>

			<header>
				<div title>Recover</div>
				<div title_buttons>

					<button
						cdkMenuItem
						class="glyph"
						[disabled]="!recoveryManager.hasPrev()"
						[cdkMenuItemDisabled]="!recoveryManager.hasPrev()"
						(click)="recoveryManager.previous()">
						<svg wGlyph="chevron_left"></svg>
					</button>
					<button
						cdkMenuItem
						class="glyph"
						[disabled]="!recoveryManager.hasNext()"
						[cdkMenuItemDisabled]="!recoveryManager.hasNext()"
						(click)="recoveryManager.next()">
						<svg wGlyph="chevron_right"></svg>
					</button>
					<button
						cdkMenuItem
						class="ghost"
						(click)="onRecoverReplace()">
						<svg wGlyph="published_with_changes"></svg>
						<span>Replace</span>
					</button>
					<button
						cdkMenuItem
						class="glyph"
						(click)="onRecoverClose()">
						<svg wGlyph="close"></svg>
					</button>

				</div>
			</header>
			<div content>

				@if(recoveryManager.recoverableContent(); as lsEntry) {

					<h6>{{ lsEntry.time.toUTCString() | timePast:true:'precise' }}</h6>
					<pre>{{lsEntry.content}}</pre>
					<w-markdown-viewer [markdown]="lsEntry.content"/>

				}

			</div>

		</div>
	</w-modal>

}

<ng-template #table_menu>

	<div class="table-menu" cdkMenu>

		<w-selector-table
			[rows]="6"
			[cols]="7"
			(result)="updateEditor(actions.addTable(editor, $event))"/>

	</div>

</ng-template>

<ng-template #format_heading>

	<div class="format-menu" cdkMenu>

		<div>

			<!-- H1 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '#'))"
				title="Align Center"
				cdkMenuItem>
				<h1>Heading 1</h1>
			</button>

			<!-- H2 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '##'))"
				title="Heading 2"
				cdkMenuItem>
				<h2>Heading 2</h2>
			</button>

			<!-- H3 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '###'))"
				title="Heading 3"
				cdkMenuItem>
				<h3>Heading 3</h3>
			</button>

			<!-- H4 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '####'))"
				title="Heading 4"
				cdkMenuItem>
				<h4>Heading 4</h4>
			</button>

			<!-- H5 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '#####'))"
				title="Heading 5"
				cdkMenuItem>
				<h5>Heading 5</h5>
			</button>

			<!-- H6 BUTTON -->
			<button
				class="ghost xl"
				(click)="updateEditor(actions.addHeading(editor, '######'))"
				title="Heading 6"
				cdkMenuItem>
				<h6>Heading 6</h6>
			</button>

		</div>

	</div>

</ng-template>

<ng-template #blockquote_menu>

	<div class="quote-menu" cdkMenu>

		<div>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor))" cdkMenuItem data-after="Blockquote">
				<span class="default"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'note'))" cdkMenuItem data-after="Note">
				<span class="primary"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'tip'))" cdkMenuItem data-after="Tip">
				<span class="success"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'important'))" cdkMenuItem data-after="Important">
				<span class="info"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'warning'))" cdkMenuItem data-after="Warning">
				<span class="warn"></span>
			</button>

			<button class="ghost" (click)="updateEditor(actions.addBlockquote(editor, 'caution'))" cdkMenuItem data-after="Caution">
				<span class="error"></span>
			</button>

		</div>

	</div>

</ng-template>

<ng-template #code_menu>

	<div class="code-menu" cdkMenu>

		<div>

			<fieldset>
				<!-- INLINE CODE BUTTON -->
				<button class="left ghost sm w100" (click)="updateEditor(actions.addInlineCode(editor))" cdkMenuItem data-after="Inline Code">
					<svg wGlyph="code"></svg>
				</button>
			</fieldset>

			<!-- todo: convert to for loop(?) -->
			<fieldset>
				<legend>Frequent</legend>

				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor))" cdkMenuItem data-after="Empty Block">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'java'))" cdkMenuItem data-after="java">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'typescript'))" cdkMenuItem data-after="typescript">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'javascript'))" cdkMenuItem data-after="javascript">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'scss'))" cdkMenuItem data-after="scss">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'bash'))" cdkMenuItem data-after="bash">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'sql'))" cdkMenuItem data-after="sql">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'xml'))" cdkMenuItem data-after="xml">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'yaml'))" cdkMenuItem data-after="yaml">
					<svg wGlyph="chevron_right"></svg>
				</button>

			</fieldset>

			<fieldset>
				<legend>Other</legend>

				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'asciidoc'))" cdkMenuItem data-after="asciidoc">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'autohotkey'))" cdkMenuItem data-after="autohotkey">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'c'))" cdkMenuItem data-after="c">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'cpp'))" cdkMenuItem data-after="cpp">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'css'))" cdkMenuItem data-after="css">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'dockerfile'))" cdkMenuItem data-after="dockerfile">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'gradle'))" cdkMenuItem data-after="gradle">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'http'))" cdkMenuItem data-after="http">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'ini'))" cdkMenuItem data-after="ini">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'json'))" cdkMenuItem data-after="json">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'kotlin'))" cdkMenuItem data-after="kotlin">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'markdown'))" cdkMenuItem data-after="markdown">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'powershell'))" cdkMenuItem data-after="powershell">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'properties'))" cdkMenuItem data-after="properties">
					<svg wGlyph="chevron_right"></svg>
				</button>
				<button class="left ghost sm w100" (click)="updateEditor(actions.addCodeBlock(editor, 'python'))" cdkMenuItem data-after="python">
					<svg wGlyph="chevron_right"></svg>
				</button>

			</fieldset>

		</div>

	</div>

</ng-template>

<!-- TEXTAREA -->
<div class="mt-2 group">

	<textarea
		#editor
		class="border-0 bg-transparent px-3 p-2 w-full text-content outline-0 peer"
		[value]="value()"
		placeholder=""
		[readonly]="readonly()"
		[disabled]="disabled()"
		(focus)="hasFocus.set(true)"
		(blur)="hasFocus.set(false)"
		(input)="onInput(editor.value)"
		[rows]="rows()"></textarea>
		<label class="
			-top-3.5
			left-2
			absolute
			text-2xs
			leading-5
			px-1
			rounded
			bg-component-dark
			text-form-element-text

			peer-focus:-top-3.5
			peer-focus:text-2xs
			peer-focus:leading-5
			peer-focus:bg-component-dark
			peer-focus:text-form-element-text

			transition-all
			duration-500

			before:content-['*']
			before:text-focus
			before:mr-1
			">{{label()}}</label>
	<label class="
			flex
			justify-end
			gap-1
			p-2

			rounded-b-lg
			bg-form-element-border
			text-form-element-text
		">
		<span class="inline-flex items-center gap-1 text-3xs leading-5">
			<svg wGlyph="disk" class="text-[1.3em]"></svg>
			{{ undoCache.discSize() }}
			<svg wGlyph="memory" class="ml-2 text-[1.3em]"></svg>
			{{ undoCache.memSize() }}
		</span>
	</label>

</div>
