<div bookmark-wrapper>

	<app-bookmark
		class="dark"
		[bookmark]="bookmark$ | async"
		[showDetails]="true"
		[disabled]="true"
		[popularButton]="false"
		[editable]="false"/>

</div>

<div bookmark-form class="d-block p-xs pt-xxl scrollable flex-1">

	<form class="d-flex-column gap">

		<div class="d-flex-column">

			<w-croppie
				class="jc-center"
				[wControl]="form.image"
				wType="circle"
				wClass="primary"/>

		</div>

		<div bookmark-form-right class="d-flex-column gap-lg p-xs">

			<!-- ID -->
			@if (bookmark?.id) {

				<w-input [formControl]="form.id" label="ID" [readonly]="true"/>

			}

			<!-- URLs -->
			@for (fcUrl of form.urls.controls; track $index) {

				<div>
					<w-input
						[formControl]="fcUrl"
						[label]="'URL' + (form.urls.controls.length > 1 && $index === 0 ? ' (Primary)' : '')"/>
						<!-- (inputChanged)="checkUrl($event, fcUrl)"/> -->
					<button *ngIf="$index === 0" type="button" class="link" title="Add URL" (click)="addURL()"><w-glyph name="add" /></button>
					<button *ngIf="$index > 0" type="button" class="link" title="Remove URL" (click)="removeURL($index)"><w-glyph name="remove" /></button>
				</div>

			}

			<!-- NAME -->
			<div>
				<w-input [formControl]="form.name" label="Name"/>
				<button type="button" class="link" title="Parse URL" (click)="nameFromURL()"><w-glyph name="move_down" /></button>
			</div>

			<!-- TITLE -->
			<div>
				<w-input [formControl]="form.title" label="Title"/>
				<button type="button" class="link" title="Lookup title" (click)="lookupTitle()"><w-glyph name="search" /></button>
			</div>

			<!-- TAGS -->
			<div>
				<w-input-tag
					[formControl]="form.tags"
					label="Tags"
					class="input-element"
					(tagInput)="onTagInput($event)"
					[suggestions]="(tagSuggestions$ | async) ?? []"/>
				<button type="button" class="link" [title]="'Toggle \''+TAG_POPULAR+'\''" (click)="onTogglePopular()">
					<span class="material-symbols-outlined" [class.filled]="((form.tags.valueChanges | async) ?? []).includes(TAG_POPULAR)">favorite</span>
				</button>
			</div>

		</div>

	</form>

</div>

<div form-element-buttons>

	@if (bookmark?.id) {

		<button type="button" (click)="onDelete()" class="error">
			<w-glyph name="delete" /> Delete
		</button>

	}
	<button type="button" (click)="onSave()">
		<w-glyph name="save" /> Save
	</button>

</div>
