<header>

	<div card_title>{{ word() ? 'Edit' : 'Add' }} Word</div>

</header>
<section content>

	<form [formGroup]="form.fgWord" (ngSubmit)="onSave()">

		<!-- ID -->
		@if (isUpdate()) {

			<w-input formControlName="id" label="ID" [readonly]="true"/>

		}

		<!-- NAME -->
		<w-input formControlName="name" label="Term"/>

		<!-- PRONUNCIATION -->
		<w-input formControlName="pronunciation" label="Pronunciation"/>

		<!-- ADD CONTEXT BUTTON -->
		<button
			add_button
			type="button"
			class="success"
			(click)="form.addContext()">
			<w-glyph name="add_circle" /> Context
		</button>

		<!-- CONTEXTS -->
		@for (context of form.contexts.controls; let wordIdx = $index; track wordIdx) {

			<div context>

				<w-textarea [formControl]="context" [label]="'Context #' + (wordIdx + 1)" [rows]="3"/>
				<button
					type="button"
					class="glyph squared sm"
					[title]="'Remove Sample #' + (wordIdx + 1)"
					(click)="form.removeContext(wordIdx)">
					<w-glyph name="do_not_disturb_on" class="focused" />
				</button>

			</div>

		}

		<!-- ITERATE DEFINITIONS -->
		@for (definition of form.definitions.controls; let defIdx = $index; track defIdx) {

			<fieldset>
				<legend>Definition #{{defIdx + 1}}</legend>

				@if(defIdx > 0) {

					<legend>
						<button
							type="button"
							class="ghost sm"
							(click)="form.removeDefinition(defIdx)">
							<w-glyph name="do_not_disturb_on" class="focused" /> Remove Definition #{{ defIdx + 1 }}
						</button>
					</legend>

				}

				<!-- DEFINITION -->
				<div definition [formGroup]="definition">

					<!-- TYPE -->
					<w-select formControlName="type" label="Type" [nodes]="DEFINITION_TYPES"/>

					<!-- ITERATE LANGUAGES -->
					@for (lang of definition.controls.languages.controls; let langIdx = $index; track langIdx) {

						<!-- DEFINITION-LANGUAGE -->
						<div language [formGroup]="lang">

							<!-- LANGUAGE -->
							<w-select formControlName="language" label="Language" [nodes]="DEFINITION_LANGUAGES"/>

							<!-- NAME -->
							<w-input formControlName="name" label="Meaning"/>

							@if(langIdx < 1) {

								<button
									type="button"
									class="glyph squared sm"
									title="Add Language"
									(click)="form.addLanguage(defIdx)">
									<w-glyph name="add_circle" class="success" />
								</button>

							} @else {

								<button
									type="button"
									class="glyph squared sm"
									[title]="'Remove Language #' + (langIdx + 1)"
									(click)="form.removeLanguage(defIdx, langIdx)">
									<w-glyph name="do_not_disturb_on" class="focused" />
								</button>

							}

						</div>

					}

					<!-- ITERATE SAMPLES -->
					@for (sample of definition.controls.samples.controls; let sampleIdx = $index; track sampleIdx) {

						<!-- SAMPLES -->
						<div sample>

							<w-textarea [formControl]="sample" [label]="'Sample #' + (sampleIdx + 1)" [rows]="3"/>
							@if(sampleIdx < 1) {

								<button
									type="button"
									class="glyph squared sm"
									title="Add Sample"
									(click)="form.addSample(defIdx)">
									<w-glyph name="add_circle" class="success" />
								</button>

							} @else {

								<button
									type="button"
									class="glyph squared sm"
									[title]="'Remove Sample #' + (sampleIdx + 1)"
									(click)="form.removeSample(defIdx, sampleIdx)">
									<w-glyph name="do_not_disturb_on" class="focused" />
								</button>

							}

						</div>

					}

				</div>
			</fieldset>

		}
		<button
			add_button
			type="button"
			class="success"
			(click)="form.addDefinition()">
			<w-glyph name="add_circle" /> Definition
		</button>

		<footer>

			<button [disabled]="this.form.fgWord.pristine || this.form.fgWord.invalid">
				<w-glyph name="save" /> {{ isUpdate() ? 'Update' : 'Create'}}
			</button>

		</footer>

	</form>

</section>
